\section{Understanding Kiva website and Dataset}

\begin{itemize}
	\item Describe what user can do on the website: search for Projects, Auto-lending setup
	\item Describe how to get the data using GraphQL, Crawling method
	\item Describe data schema: fields that we can get, the meaning of each fields
	\item Describe preprocessing steps with the data
	      \begin{itemize}
		      \item Steps: accelerated loading, forming the big table, removing unwanted tags, remove anonymous Lenders, handle duplicates\dots
		      \item Forming the tri-partite graph: Lenders-Projects-Tags
		      \item Mention that we have to use CuDF for accelerated data handling
	      \end{itemize}
\end{itemize}

In this section, we will describe the Kiva website and the dataset that we use in this thesis.
We will also describe the preprocessing steps that we have to do with the dataset.

While there are many crowdfunding platforms,
we specifically choose Kiva because of its transparancy and the avalability of the data for public access.

\subsection{Kiva website}

To understand the data that the platform provides, we have to understand the interface that the platform provides to its users.
Like other platform, Kiva has a website where users can login and interact with the platform.
To understand the data that the platform provides and to extract meaningfull insight from the data,
we have to understand the interface that the platform provides to its users.

Any website interface is designed to make users interact with it in a pre-defined way.
In Kiva, we belived that the most function that users can do is to search for projects that they want to fund.
Or they can setup an Auto-Lending program, which will automatically fund projects that fit their criteria.


\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{images/kiva-browse-project.png}
	\caption{Kiva website interface for browsing projects}
	\label{fig:kiva-browser-project}
\end{figure}

It is important to know what Lenders can do when looking for his or her interested project.
Table \ref{tab:browser-criteria} shows the criteria that Lenders can use to filter the projects.
Later in the thesis, we will see that these criteria is not very align with the public data that the platform provide.
For example in the data, we could see some Tags that did not appear in the Tags list in the website.
We will consider these criteria as the gold standard for processing the data.

\begin{table}[H]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|c|c|c|c|}
			\hline
			   & Meaning                       & Type            & choices                                                                                                                 \\
			\hline
			1  & Gender of the borrower button & Choice          & Woman or Men or Nonbinary                                                                                               \\
			2  & Filter by type of Loan        & Choice          & Individual or Group                                                                                                     \\
			3  & Search by keyword             & Text            & Put any keyword to search in the stories of Projects                                                                    \\
			4  & Sort Order                    & Choice          & Amount: High to Low, Amount left, Amount: Low to High, Ending soon, Most recent, Trending now, Loan Length, Recommended \\
			5  & Location                      & Multiple choice & Choose from a list of countries                                                                                         \\
			6  & Sector                        & Multiple choice & Choose from a list of sectors                                                                                           \\
			7  & Attribute                     & Multiple choice & Choose from a list of attributes                                                                                        \\
			8  & Tags                          & Multiple choice & Choose from a list of tags                                                                                              \\
			9  & Loan Length                   & Choice          & All loans, 8 month or less, 16 months or less, 2 years or less, 2 years or more                                         \\
			10 & Loan Distribution             & Choice          & All loans, Parter, Direct                                                                                               \\
			11 & Partner Info                  & Text            & Search by Partner name                                                                                                  \\
			12 & Risk Rating                   & Range           & From 1 to 5                                                                                                             \\
			13 & Default Rate                  & Range           & From 0\% to 100\%                                                                                                       \\
			14 & Profitability                 & Range           & From -160\% to 90\%                                                                                                     \\
			\hline
		\end{tabular}%
	}
	\caption{Table with 4 columns \cite{kiva-browse}}
	\label{tab:browser-criteria}
\end{table}

Perhaps the most unique feature of Kiva is the Auto-Lending program.
In the program, Lenders can setup criterias for future projects that they want to fund.
When a new project is created, the platform will automatically fund the project if it fits the criterias.
Figure \ref{fig:auto-lend-setup} shows the interface for setting up the Auto-Lending program.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{images/auto-lend-setup.png}
	\caption{Auto-Lending setup interface \cite{kiva-autolend2}}
	\label{fig:auto-lend-setup}
\end{figure}

Users can "Let Kiva select the best loans for me" or "I want to set my own auto-lending criteria".
We do not have any information about how the platform select the best loans for users.
So we will focus on the second option.
We can see that the criterias are very similar to the criterias that users can use to search for projects.

\subsection{Kiva Data Access}

In order to access the data provided by Kiva, we utilize the GraphQL API.
Kiva has made their data available through this API, allowing developers to query and retrieve specific information from the platform.
This is perhap unique to Kiva, as most other crowdfunding platforms do not provide such access to their data.
It is also note that Kiva also provides a public dataset through their so called "Data Snapshot".
However, this function is appearantly not working at the time of writing.
There also another way to get the data from kiva website, which is through Web Crawling.
By analysis the website interface and the network traffic, we can get the data that the website use to display the information.
This approach is although popular, but it is not very reliable because the website can change its interface at any time.
In this thesis, we will focus on the GraphQL API.

GraphQL is a query language for APIs that provides a flexible and efficient way to request and manipulate data.
It allows us to specify the exact data we need and retrieve it in a single request, reducing the amount of network traffic and improving performance.
By leveraging the GraphQL API, we can easily access various data points such as borrower information, loan details, lender statistics, and more.
This enables us to perform in-depth analysis and gain valuable insights from the Kiva dataset.
The availability of Kiva's data through GraphQL provides us with a powerful tool to explore and analyze the platform's data in a convenient and efficient manner.

There are two noteworthy points about the GraphQL API.
The first is through the \textit{introspection} \cite{graphql-introspection} feature of GraphQL,
we could have the information of what queries that the platform supports,
as long as with the data schema.
The second is that we can ultilize the GraphQL API to get the data in a batched manner.
Usually the platform will limit the number of requests that a user can make to the API.
But if we use some Web Crawling techniques, we can manage to get all the data that avaliable in the API.

Kiva GraphQL API can be found publicly at \url{https://api.kivaws.org/graphql}.
One can connect to the URI with any compatible GraphQL client.
On top of that, kiva also use \textit{GraphQLi}, a web interface for easy try the GraphQL queries.
\ref{fig:grapqli} is the screenshot of the web interface.
We use the interface to introspection the data schema and to try out some queries before actually implementing them in the code.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{images/grapqli.png}
	\caption{GraphQLi interface of Kiva GraphQL API}
	\label{fig:grapqli}
\end{figure}

For example, we could try the query for getting basic stats of kiva like following Figure \ref{fig:graphqli-example}.
One can use the Docs side bar (the right side bar) to discover what is the data that the API offer.
A basic knowledge about GraphQL would be helpful to discover the data schema more easily.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{images/graphqli-example.png}
	\caption{Example using GraphQLi interface of Kiva GraphQL API \cite{graphqli-example}}
	\label{fig:graphqli-example}
\end{figure}


Before begining to query the data, we have to understand the data schema to know what data that we can get.


\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{images/graphuml/dataschema.png}
	\caption{Data schema}
	\label{fig:data-schema}
\end{figure}

The relationship beteen Lender and Project is many-to-many.
Each Project in Kiva can be funded by many Lenders.
And each Lender can fund many Projects.
The relationship between Project and Tag is also many-to-many.
The fields that we could get from each Project is described in Table \ref{tab:fields-meaning}.
We have to note that, in the APIs, kiva use the term "Loan" to indicate a single project.
We found it rather misunderstanding to use "Loan", so we try our best to use "Project" to avoid those misleading.
In this thesis, if a "Loan" appear (with the letter L in capital), one can understand the meaning is a "Project".


\begin{longtable}{|p{0.33\textwidth}|p{0.67\textwidth}|}
	\toprule\noalign{}
	\caption{Fields of Projects}
	\label{tab:fields-meaning}                                                                               \\

	\hline
	\multicolumn{1}{|c|}{\textbf{Field}} & \multicolumn{1}{c|}{\textbf{Meaning}}                             \\
	\hline
	\endfirsthead

	\multicolumn{2}{c}%
	{{\bfseries \tablename\ \thetable{} -- continued from previous page}}                                    \\
	\hline
	\multicolumn{1}{|c|}{\textbf{Field}} & \multicolumn{1}{c|}{\textbf{Meaning}}                             \\
	\hline
	\endhead

	\hline
	\multicolumn{2}{|r|}{{Continued on next page}}                                                           \\ \hline
	\endfoot

	\hline \hline
	\endlastfoot

	activity                             & The activity is a structured categorization of the loan
	use                                                                                                      \\
	anonymizationLevel                   & The level of borrower privacy                                     \\
	borrowerCount                        & The number of borrowers participating in the loan                 \\
	borrowers                            & The one or more borrowers that are receiving this loan. If
	there is more than one, the primary borrower is first                                                    \\
	dafEligible                          & Whether or not the loan is eligible for donor-advised
	funds.                                                                                                   \\
	delinquent                           & Whether or not the loan is delinquent. This defaults to
	false if the user is not privileged to this loan                                                         \\
	description                          & The description of the loan profile in English.                   \\
	descriptionInOriginalLanguage        & The description of the loan profile in
	the original language of its posting                                                                     \\
	disbursalDate                        & The date on which the loan was/will actually be
	disbursed to the borrower                                                                                \\
	distributionModel                    & How the loan is distributed to the borrower,
	e.g.~`field\_partner' or `direct'                                                                        \\
	endorser                             & The user who endorsed the loan. Only shown on fundRaising
	loans, null for all other statuses.                                                                      \\
	fundraisingDate                      & When the loan started fundraising on Kiva. Same as
	posted\_date in v1.                                                                                      \\
	gender                               & The gender of the primary borrower OR majority gender if
	group                                                                                                    \\
	geocode                              & The physical location of the borrower and/or business             \\
	hasCurrencyExchangeLossLenders       & Whether or not the loan has currency
	loss to lenders. Only usable after the loan has moved into the ``ended''
	state.                                                                                                   \\
	id                                   & Unique identifier for a Kiva loan                                 \\
	image                                & The picture for this loan profile.                                \\
	isMatchable                          & Is this Kiva loan matchable? e.g.~is there a source of
	funds to provide matching if a share is purchased?                                                       \\
	inPfp                                & If true, this loan is in a Private Fundraising Period             \\
	loanAmount                           & The amount of this loan, as shown to lenders                      \\
	loanFundraisingInfo                  & Information about this loan during its fundraising
	period                                                                                                   \\
	lenderRepaymentTerm                  & The number of months it will take the borrower to
	repay the loan                                                                                           \\
	matcherAccountId                     & The id of the loan matcher                                        \\
	matcherName                          & The name of the loan matcher                                      \\
	matchRatio                           & The loan match ratio                                              \\
	matchingText                         & Text that is displayed if loan matching is turned on for
	this loan.                                                                                               \\
	name                                 & The name of the borrower or group receiving the loan              \\
	originalLanguage                     & The original language on the loan                                 \\
	minNoteSize                          & The minimum amount to lend for this loan                          \\
	paidAmount                           & The amount of settled repayments for a loan that has
	started paying back                                                                                      \\
	pfpMinLenders                        & The minimum number of lenders that this loan needs to
	exit its private fundraising period (PFP).                                                               \\
	plannedExpirationDate                & When the loan will expire if it is not fully
	funded                                                                                                   \\
	previousLoanId                       & ID of the loan linked as previous to this one.                    \\
	raisedDate                           & When the loan became raised, e.g.~fully funded. Same as
	funded\_date in v1                                                                                       \\
	researchScore                        & The research score of the loan theme instance of the
	loan                                                                                                     \\
	repaymentInterval                    & The repayment interval of the loan: ``monthly'',
	``irregularly'',``at\_end''                                                                              \\
	sector                               & The sector is a more general classification of the loan than
	activity                                                                                                 \\
	status                               & The status of a loan                                              \\
	tags                                 & A list of tags on this loan                                       \\
	terms                                & The financial terms of this loan                                  \\
	use                                  & Text describing what the loan is to be used for; a logical subset
	of description e.g.~``To buy a cow''                                                                     \\
	userProperties                       & Properties that apply to the logged in user in relation
	to a loan.                                                                                               \\
	video                                & Video for this loan                                               \\
	whySpecial                           & Why this loan is considered special.                              \\
	comments                             & List of A user comment made on a Kiva loan.                       \\
	lenders                              & List of Representation of a Kiva lender                           \\
	lendingActions                       & List of Representation of a lending action                        \\
	teams                                & List of Representation of a Kiva lending team                     \\
\end{longtable}

The example data that we get from the API is shown in Figure \ref{fig:example-data}.

\begin{longtable}{|p{0.36\textwidth}|p{0.64\textwidth}|}
	\toprule\noalign{}
	\caption{An Example Project}
	\label{fig:example-data}                                                                                   \\

	\hline
	\multicolumn{1}{|c|}{\textbf{Field}} & \multicolumn{1}{c|}{\textbf{Meaning}}                               \\
	\hline
	\endfirsthead

	\multicolumn{2}{c}%
	{{\bfseries \tablename\ \thetable{} -- continued from previous page}}                                      \\
	\hline
	\multicolumn{1}{|c|}{\textbf{Field}} & \multicolumn{1}{c|}{\textbf{Meaning}}                               \\
	\hline
	\endhead

	\hline
	\multicolumn{2}{|r|}{{Continued on next page}}                                                             \\ \hline
	\endfoot

	\hline \hline
	\endlastfoot

	anonymizationLevel                   & none                                                                \\
	borrowerCount                        & 1                                                                   \\
	borrowers                            & {[}\{`id': 2843387, `borrowedAmount': `440.80', `firstName':
	`Jessenia Elizabeth', `gender': `female', `isPrimary': True, `pictured':
	True\}{]}                                                                                                  \\
	dafEligible                          & False                                                               \\
	delinquent                           & False                                                               \\
	disbursalDate                        & 2013-09-25T07:00:00Z                                                \\
	distributionModel                    & fieldPartner                                                        \\
	endorser                             &                                                                     \\
	fundraisingDate                      & 2013-10-23T22:40:01Z                                                \\
	gender                               & female                                                              \\
	hasCurrencyExchangeLossLenders       & False                                                               \\
	id                                   & 623042                                                              \\
	isMatchable                          & False                                                               \\
	inPfp                                & False                                                               \\
	loanAmount                           & 450.00                                                              \\
	lenderRepaymentTerm                  & 8                                                                   \\
	matcherAccountId                     &                                                                     \\
	matcherName                          &                                                                     \\
	matchRatio                           &                                                                     \\
	matchingText                         &                                                                     \\
	name                                 & Jessenia Elizabeth                                                  \\
	minNoteSize                          & 25.00                                                               \\
	paidAmount                           & 0.00                                                                \\
	pfpMinLenders                        &                                                                     \\
	plannedExpirationDate                & 2013-11-22T22:40:01Z                                                \\
	previousLoanId                       &                                                                     \\
	raisedDate                           & 2013-10-24T13:38:51Z                                                \\
	researchScore                        & 9                                                                   \\
	repaymentInterval                    & monthly                                                             \\
	status                               & funded                                                              \\
	tags                                 & {[}{]}                                                              \\
	use                                  & purchase school supplies and other stationery items for her
	store.                                                                                                     \\
	video                                &                                                                     \\
	whySpecial                           &                                                                     \\
	activity.id                          & 103                                                                 \\
	activity.name                        & Paper Sales                                                         \\
	geocode.city                         & Pichincha                                                           \\
	geocode.state                        & Pichincha                                                           \\
	geocode.country.name                 & Ecuador                                                             \\
	geocode.country.isoCode              & EC                                                                  \\
	geocode.country.region               & South America                                                       \\
	geocode.country.ppp                  & \$10,600                                                            \\
	geocode.country.numLoansFundraising  & 553                                                                 \\
	geocode.country.fundsLentInCountry   & 87573245                                                            \\
	geocode.postalCode                   &                                                                     \\
	geocode.latitude                     & -0.1464847                                                          \\
	geocode.longitude                    & -78.4751945                                                         \\
	image.id                             & 1456025                                                             \\
	image.url                            &
	https://www-kiva-org-0.freetls.fastly.net/img/s100/5cf86ba6c72db94f0721b934a57ca889.jpg                    \\
	loanFundraisingInfo.fundedAmount     & 450.00                                                              \\
	loanFundraisingInfo.isExpiringSoon   & False                                                               \\
	loanFundraisingInfo.reservedAmount   & 0.00                                                                \\
	originalLanguage.id                  & 2                                                                   \\
	originalLanguage.isActive            & True                                                                \\
	originalLanguage.isoCode             & ES                                                                  \\
	originalLanguage.name                & Spanish                                                             \\
	sector.id                            & 7                                                                   \\
	sector.name                          & Retail                                                              \\
	terms.currency                       & USD                                                                 \\
	terms.currencyFullName               & United States Dollars                                               \\
	terms.disbursalAmount                & 440.80                                                              \\
	terms.disbursalDate                  & 2013-09-25T07:00:00Z                                                \\
	terms.expectedPayments               & {[}{]}                                                              \\
	terms.loanAmount                     & 450.00                                                              \\
	terms.lenderRepaymentTerm            & 8                                                                   \\
	terms.lossLiabilityCurrencyExchange  & none                                                                \\
	terms.lossLiabilityNonpayment        & lender                                                              \\
	terms.flexibleFundraisingEnabled     & False                                                               \\
	userProperties.favorited             &                                                                     \\
	userProperties.lentTo                &                                                                     \\
	userProperties.subscribed            &                                                                     \\
	userProperties.promoEligible         & False                                                               \\
	userProperties.amountInBasket        &                                                                     \\
	lendingActions.totalCount            & 14                                                                  \\
	lendingActions.values                & {[}\{`lender': \{`id': 32817, `name': `Nate',
	`publicId': `nateinaction'\}, `shareAmount': `25.00', `teams': {[}`(A+)
	Atheists'{]}, `latestSharePurchaseDate': `2013-10-24T11:50:07Z'\},
	\{`lender': \{`id': 55596, `name': `Dirk L.', `publicId': `DirkLebe'\},
	`shareAmount': `25.00', `teams': {[}{]}, `latestSharePurchaseDate':
	`2013-10-24T02:40:53Z'\}{]}                                                                                \\
	description                          & Every fifteen days, the members of the Community Bank of
	Pichincha meet in their home region of Pichincha. This area is well
	known as a vibrant place, where the majority of the people are farmers
	or ranchers. It's a highly vegetated area, cut by a great river that
	nurtures the crops.                                                                                        \\
	                                     & This is where Jessenia, 27 years old, lives with her common-law
	husband and their three children, aged 9, 4, and 2 years. The eldest is
	a student, and her husband is a shopkeeper.Jessenia is a woman with
	spirit who likes to work to get ahead. For the last six years, she has
	run a shop out of her home that functions as a stationery shop and a
	bookstore. Day by day, the store has improved. Currently, apart from
	books and supplies, she also sells trinkets and other school/office
	supplies. With these products, her earnings have greatly increased, and
	thanks to the loans she has received, she has been able to expand her
	business.                                                                                                  \\
	                                     & This loan will be used to buy school supplies and other stationery
	products. She has been in the Community Bank for eight years and she
	likes it because the loans have helped her improve her business. She
	dreams of expanding it further still.                                                                      \\
	descriptionInOriginalLanguage        & En el cantón Pichincha cada quince días
	se reúne el Banco Comunal Pichincha, este lugar se lo conoce por ser muy
	dinámico donde la mayoría de sus habitantes se dedican a la agricultura
	y a la cría de animales, por ser una zona con gran vegetación surcada
	por un gran rio lo cual lo hace propicia para los cultivos.                                                \\
	                                     & En este lugar vive la señora Jessenia, tiene 27 años de edad y
	mantiene una relación de unión libre de la cual tiene tres hijos de 9, 4
	y 2 años de edad, el mayor estudia en escuela. El marido es
	comerciante.                                                                                               \\
	                                     & Doña Jessenia es una mujer muy luchadora que le gusta trabajar para
	salir adelante, ella hace mas de 6 años adecuo un local en su casa y en
	el mismo instaló una papelería y librería, la misma que con el paso de
	los días ha ido mejorando, actualmente además de libros y útiles también
	vende bisutería y artículos de bazar con esto sus ganancias han mejorado
	mucho y esto gracias a los créditos que ha recibido ya que con ellos
	cada vez aumenta más su negocio.                                                                           \\
	                                     & Este crédito es para comprar útiles escolares y artículos de bazar.
	Esta desde hace 8 años en el Banco Comunal y le gusta porque los
	créditos le han ayudado a mejora su negocio. Sus sueños son aumentar más
	su negocio.                                                                                                \\
\end{longtable}

\section{Basic data statistics}

\begin{itemize}
	\item Worldwide statistics
	      \begin{itemize}
		      \item How many projects
		      \item how many lenders
		      \item projects vs country distribution
		      \item successful rate
		      \item \textbf{How long that users stay on the platform}
	      \end{itemize}
	\item Vietnam statistics
	      \begin{itemize}
		      \item How many projects
		      \item \dots
	      \end{itemize}
\end{itemize}